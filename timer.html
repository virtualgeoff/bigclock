<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Big Clock: Timer</title>
	<meta name="description" content="A timer, but BIG!">
	<meta name="keywords" content="clock, timer, big">
	<meta name="author"   content="Geoff Pack">
	<meta name="created"  content="2022-09-16">
	<meta name="modified" content="2022-09-30">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="color-scheme" content="light dark">
	<link rel="icon" href="data:,">
	<style>

		html, body {margin:0; padding:0;}
		body {height:calc(100vh + 18365px); font-size:1em; font-family:'Courier', monospace;}
		nav, main, div {box-sizing:border-box;}

		h1 {}
		p {}
		small {font-size:0.667em;}
		.hide {display:none;}
		button {width:5em; padding:0.5em; font-size:3vw; cursor:pointer;}
		/* for button styling, see: https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button */

		table {border:1px solid rgba(128,128,128,0.2); border-collapse:collapse;}
		th {padding:0.1em 1em; text-align:center; border:1px solid rgba(128,128,128,0.2);}
		td {padding:0.1em 1em; text-align:right;  border:1px solid rgba(128,128,128,0.2);}

		a {text-decoration:none;}
		a:hover {text-decoration:underline;}

		/* layout */
		main  {position:fixed; left:0; top:0; width:100vw; height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:space-evenly;}
		main h1, main p {margin:0; padding:0; text-align:center; line-height:1.0;}
		main h1 {line-height:0.7;}

		#date {margin:1em 0; font-size:5vw;  font-weight:200;}
		#time {margin:0 0; padding:0 0.3em; font-size:19vw; font-weight:normal;}
		#setter {margin:1em 0; font-size:1.5em;}
		#slider {margin:3em 0 0 0; font-size:1.5em;}
		#slider span {opacity:0.5;}
		#slider input {width:50vw; padding:0.2em 0; font-size:5vw;}
		#buttons {margin:1em 0; font-size:5vw;  font-weight:200;}
		#date {opacity:0.28;}

		/* nav */
		nav {position:fixed; left:0; top:0; width:100%; margin:0; z-index:99;}
		nav a {display:inline-block; margin:0.6em -0.6em 0.6em 0.6em;}
		nav a:hover {text-decoration:none;}
		nav .right {float:right; margin-right:0.6em;}
		nav svg {width:1.625em; height:1.625em;}

		/* colors */
		body, body.light {color:#111; background:#fff;}
		body.dark {color:#ddd; background:#000;}

		a, body.light a {color:#00e;}
		a:visited, body.light a:visited {color:#808;}
		nav a, nav a:visited, body.light nav a, body.light nav a:visited {color:#666;}
		nav a:hover, body.light nav a:hover {color:#f00;}

		body.dark a {color:#07d;}
		body.dark a:visited {color:#d7d;}
		body.dark nav a, body.dark nav a:visited {color:#999;}
		body.dark nav a:hover {color:#c00;}

		@media (prefers-color-scheme: dark) {
			body {color:#eee; background:#000;}
			a {color:#07d;}
			a:visited {color:#d7d;}
			nav a, nav a:visited {color:#999;}
			nav a:hover {color:#c00;}
		}

	</style>
	<script>

		/* jshint esversion: 5 */

		var showHundredths = true; // timer always shows hundredths
		var dynamicColors = false;
		var bgColor, h, s, l;

		function getOptions() {
			// load options from localStorage on page load, and set colors, font, ...
			var colorScheme = localStorage.getItem('colorScheme');
			var fontFamily  = localStorage.getItem('fontFamily');
			//showHundredths = JSON.parse(localStorage.getItem('showHundredths')); // convert from string!
			var timerData  = localStorage.getItem('timerData');

			if (colorScheme) {
				document.body.classList.add(colorScheme);
				if (colorScheme === 'Dynamic') {
					dynamicColors = true;
				} else if (colorScheme === 'Custom') {
					document.body.style.backgroundColor = localStorage.getItem('colorBG') || '#ff7700';
					document.body.style.color = localStorage.getItem('colorText') || '#000000';
				}
			}
			if (fontFamily) {
				document.body.style.fontFamily = fontFamily;
			}
			if (timerData) {
				Timer.setData( JSON.parse(timerData) );
			}
		}

		function setDynamicColors(now) {
			// set colors based on the current local time
			h = now.getHours() * 15 + now.getMinutes() * 15/60; // 0-360Â°
			s = now.getMinutes() + 40; // 40-100%
			l = now.getSeconds() + 20; // 20-80%;
			bgColor = 'hsl(' + h + ' ' + s + '% '+ l + '%)';
			//console.log(bgColor);
			document.body.style.backgroundColor = bgColor;
			document.body.style.color = (l>50) ? '#111' : '#ddd';
		}

		function fullscreen(e) {
			// toggle fullscreen mode
			//e.preventDefault();
			var d = document, dE = d.documentElement;

			if (d.fullscreenElement || d.webkitFullscreenElement) {
				if (d.exitFullscreen) {
					d.exitFullscreen();
				} else if (d.webkitCancelFullScreen) {
					d.webkitCancelFullScreen();
				}
			} else {
				if (dE.requestFullscreen) {
					dE.requestFullscreen();
				} else if (dE.webkitRequestFullScreen) {
					dE.webkitRequestFullScreen();
				}
			}
		}

		var Timer = (function() {
			// timer data and methods
			var isRunning = false,
				endTime = null,
				duration = 300000, // = 5 minutes
				timeRemaining = duration;

			var timeStr, years, days, hours, minutes, seconds, hundredths, milliseconds;
			var fontSize = 19; // vh

			function setData(obj) {
				// set timer data (on page load)
				console.log(obj);
				isRunning = obj.isRunning;
				endTime = obj.endTime;
				duration = obj.duration;
				timeRemaining = obj.timeRemaining;
				if (isRunning) { document.getElementById('start').innerText = 'Stop'; }
				update();
			}

			function saveData() {
				// save timer data to localStorage
				var obj = {
					'isRunning': isRunning,
					'endTime': endTime,
					'duration': duration,
					'timeRemaining': timeRemaining
				};
				localStorage.setItem('timerData', JSON.stringify(obj));
			}

			function deleteData() {
				localStorage.removeItem('timerData');
			}

			function setDuration(form) {
				// set duration via form
				if (!isRunning) {
					duration = (parseInt(form.dd.value * 86400) + parseInt(form.hh.value * 3600) + parseInt(form.mm.value * 60) + parseInt(form.ss.value)) * 1000;
					timeRemaining = duration;
					update();
				}
			}

			function setDurationScroll() {
				// set duration via page scroll
				var n = parseInt(document.documentElement.scrollTop / 20);
				if (n < 1) n = 1;
				var d = 1;
				//console.log(document.documentElement.scrollTop, n);

				if (!isRunning) {
					if (n <= 60) {
						d = n; // 0-60s
					} else if (n <= 114) {
						d = (n-60) * 10 + 60; // 1-10m in 10s steps
					} else if (n <= 164) {
						d = (n-114) * 60 + 600; // 10-60m in 1m steps
					} else if (n <= 230) {
						d = (n-164) * 600 + 3600; // 1-12h in 10m steps
					} else if (n <= 254) {
						d = (n-230) * 1800 + 43200; // 12-24h in 30m steps
					} else if (n <= 566) {
						d = (n-254) * 3600 + 86400; // 1-14d in 1h steps
					} else {
						d = (n-566) * 86400 + 1209600; // 14-999d in 1d steps
					}
					duration = d * 1000;
					timeRemaining = duration;
					update();
				}
			}

			function start() {
				// start/stop timer
				if (isRunning) {
					isRunning = false;
					endTime = null;
					document.getElementById('start').innerText = 'Start';
				} else {
					isRunning = true;
					endTime = Date.now() + timeRemaining;
					document.getElementById('start').innerText = 'Stop';
				}
				update();
				saveData();
			}

			function reset() {
				// reset timer
				timeRemaining = duration;
				endTime = (isRunning) ? (Date.now() + timeRemaining) : null;
					document.getElementById('start').classList.remove('hide');
					document.getElementById('start').innerText = 'Start';
				saveData();
				update();
			}

			function pad2(n) {
				// make 2 digits
				return (n < 10) ? ('0' + n) : n;
			}
			function pad3(n) {
				// make 3 digits
				return (n < 100) ? ('0' + pad2(n)) : n;
			}

			function formatTime(time) {
				// format the time as yyy:ddd:hh:mm:ss.ss
				milliseconds = time % 1000;
				hundredths = Math.floor(milliseconds/10);
				seconds = Math.floor(time/1000);
				minutes = Math.floor(seconds/60);
				hours   = Math.floor(minutes/60);
				days    = Math.floor(hours/24);
				years   = Math.floor(days/365);

				//timeStr = pad3(years) + ':' + pad3(days % 365) + ':' + pad2(hours % 24) + ':' + pad2(minutes % 60) + ':' + pad2(seconds % 60);
				timeStr = '';
				if (years > 0) timeStr += pad3(years) + ':';
				if (days  > 0) timeStr += pad3(days % 365) + ':';
				if (hours > 0) timeStr += pad2(hours % 24) + ':';
				timeStr += pad2(minutes % 60) + ':' + pad2(seconds % 60) + '<small>.' + pad2(hundredths) + '</small>';
				return timeStr;
			}

			function checkFontSize() {
				// check the width of the time element and reduce the font-size until it fits the window
				if ((document.getElementById('time').clientWidth / window.innerWidth) < 0.8) {
					fontSize = 19;
					document.getElementById('time').style.fontSize = fontSize + 'vw';
					//console.log('font-size reset to 19vw');
				}
				while (document.getElementById('time').clientWidth > window.innerWidth) {
					fontSize -= 0.5;
					document.getElementById('time').style.fontSize = fontSize + 'vw';
					//console.log('font-size reduced to ' + fontSize + 'vw');
				}
				}

			function update() {
				// update the timer
				if (isRunning) { timeRemaining = endTime - Date.now(); } // in milliseconds
				if (timeRemaining <= 0) {
					timeRemaining = 0;
					isRunning = false;
					document.getElementById('start').classList.add('hide');
					setTimeout(function(){window.alert('Times up!');}, 20);
				}

				document.getElementById('time').innerHTML = formatTime(timeRemaining);
				checkFontSize();

				if (dynamicColors) { setDynamicColors(new Date()); }

				if (isRunning) {
					if (showHundredths && window.requestAnimationFrame) {
						window.requestAnimationFrame(update);
					} else {
						setTimeout(update, 1000/60);
					}
				}
			}

			return {
				setData: setData,
				setDuration: setDuration,
				setDurationScroll: setDurationScroll,
				start: start,
				reset: reset
			};
		})();

		window.addEventListener('DOMContentLoaded', getOptions);
		window.addEventListener('scroll', Timer.setDurationScroll);

	</script>
</head>
<body>

	<nav>
		<a href="/" title="Home">
			<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 40 40" version="1.1">
				<circle cx="20" cy="20" r="15" stroke="currentColor" stroke-width="3.5" fill="none"/>
				<path stroke="currentColor" stroke-width="3.5" stroke-linecap="round" fill="none" d="M20 20 L20 10 M20 20 L28 20"/>
			</svg>
		</a>
		<a href="about.html" title="About">
			<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 40 40" version="1.1">
				<circle cx="20" cy="20" r="15" stroke="currentColor" stroke-width="3.5" fill="none"/>
				<circle cx="20" cy="12.5" r="2" stroke="none" fill="currentColor"/>
				<path stroke="currentColor" stroke-width="3" stroke-linecap="round" fill="none" d="M20.5 17.5 L20.5 26.5 M17.0 17.5 L20.0 17.5 M16.0 26.5 L25.0 26.5"/>
			</svg>
		</a>
		<a href="#fullscreen" id="fullscreen" title="Make full screen" onclick="fullscreen(); return false;">
			<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 40 40" version="1.1">
				<rect x="6" y="14" width="20" height="20" stroke="currentColor" stroke-width="3" fill="none" />
				<rect x="12" y="6" width="22" height="22" stroke="currentColor" stroke-width="3" fill="none"/>
			</svg>
		</a>
		<a href="settings.html" title="Settings" class="right">
			<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 40 40" version="1.1">
				<path fill="currentColor" d="m15.67 36.96-.8-5.38q-.62-.25-1.3-.64-.7-.4-1.24-.82L7.3 32.34l-4.33-7.62 4.46-3.34-.07-.66-.02-.71.02-.7.07-.68-4.46-3.33 4.33-7.62 5.04 2.2q.54-.41 1.23-.8.69-.4 1.31-.61l.8-5.42h8.66l.8 5.38q.62.25 1.33.64.7.4 1.2.81l5.05-2.2 4.33 7.62-4.5 3.3q.09.33.1.7.03.38.03.71l-.02.7q-.02.38-.1.72l4.5 3.29-4.38 7.62-5-2.2q-.55.41-1.21.83-.67.41-1.34.62l-.79 5.38ZM20 25.54q2.3 0 3.92-1.62 1.62-1.63 1.62-3.92 0-2.3-1.62-3.92-1.63-1.62-3.92-1.62-2.3 0-3.92 1.62-1.62 1.63-1.62 3.92 0 2.3 1.62 3.92 1.63 1.62 3.92 1.62Zm0-2.75q-1.17 0-1.98-.81T17.21 20q0-1.17.81-1.98t1.98-.81q1.17 0 1.98.81t.81 1.98q0 1.17-.81 1.98t-1.98.81ZM20 20Zm-1.7 13.8h3.37l.58-4.6q1.38-.32 2.58-1.01 1.21-.69 2.17-1.69l4.33 1.83 1.55-2.79-3.8-2.79q.17-.67.27-1.35.1-.7.1-1.4t-.07-1.4q-.09-.68-.3-1.35l3.8-2.8-1.55-2.78L27 13.5q-.92-1.04-2.13-1.77-1.2-.73-2.62-.94l-.54-4.58h-3.38l-.58 4.54q-1.42.33-2.63 1.02-1.2.69-2.16 1.73l-4.3-1.83-1.54 2.79 3.75 2.75q-.16.7-.27 1.4-.1.68-.1 1.39 0 .7.1 1.4.1.68.28 1.35l-3.76 2.8 1.55 2.78 4.29-1.83q1 1 2.2 1.7 1.21.72 2.59 1.05Z"/>
			</svg>
		</a>
	</nav>

	<main>
		<p id="date">Timer</p>
		<h1 id="time">05:00<small>.00</small></h1>
		<p id="buttons">
			<button type="button" id="start" onclick="Timer.start()">Start</button>
			<button type="button" id="reset" onclick="Timer.reset()">Reset</button>
		</p>
		<p id="setter">Scroll page to set timer...</p>
		<!-- p id="slider"><span>drag to set timer duration:</span><br>
			<input id="durationRange" type="range" min="1" max="1122"  step="1" value="84" list="tickmarks" oninput="Timer.setDuration(this.value)">
			<datalist id="tickmarks">
				<option value="1"></option>
				<option value="60"></option>
				<option value="114"></option>
				<option value="164"></option>
				<option value="230"></option>
				<option value="254"></option>
				<option value="398"></option>
				<option value="421"></option>
				<option value="481"></option>
				<option value="571"></option>
				<option value="756"></option>
				<option value="1122"></option>
			</datalist>
		</p -->
		<form onsubmit="Timer.setDuration(this); return false;">
			<input type="number" name="dd" min="0" max="999" value="0">d :
			<input type="number" name="hh" min="0" max="23" value="0">h :
			<input type="number" name="mm" min="0" max="59" value="5">m :
			<input type="number" name="ss" min="0" max="59" value="0">s
			<input type="submit" value="Set timer">
		</form>
	</main>

	<!-- simple analytics -->
	<script async defer src="https://scripts.simpleanalyticscdn.com/latest.js"></script>
	<noscript><img src="https://queue.simpleanalyticscdn.com/noscript.gif" alt="" referrerpolicy="no-referrer-when-downgrade" /></noscript>


</body>
</html>
